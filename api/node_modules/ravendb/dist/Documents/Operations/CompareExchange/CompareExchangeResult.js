"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Serializer_1 = require("../../../Mapping/Json/Serializer");
const Exceptions_1 = require("../../../Exceptions");
const TypeUtil_1 = require("../../../Utility/TypeUtil");
class CompareExchangeResult {
    static parseFromString(responseString, conventions, clazz) {
        const response = Serializer_1.JsonSerializer.getDefault().deserialize(responseString);
        const index = response["Index"];
        if (!index) {
            Exceptions_1.throwError("InvalidOperationException", "Response is invalid. Index is missing");
        }
        const successful = response["Successful"];
        const raw = response["Value"];
        let result;
        let val = null;
        if (raw) {
            val = raw["Object"];
        }
        if (!val) {
            const emptyExchangeResult = new CompareExchangeResult();
            emptyExchangeResult.index = index;
            emptyExchangeResult.value = null;
            emptyExchangeResult.successful = successful;
            return emptyExchangeResult;
        }
        conventions.tryRegisterEntityType(clazz);
        if (TypeUtil_1.TypeUtil.isPrimitive(val)) {
            result = val;
        }
        else {
            const entityType = conventions.findEntityType(clazz);
            result = conventions.deserializeEntityFromJson(entityType, val);
        }
        const exchangeResult = new CompareExchangeResult();
        exchangeResult.index = index;
        exchangeResult.value = result;
        exchangeResult.successful = successful;
        return exchangeResult;
    }
}
exports.CompareExchangeResult = CompareExchangeResult;
