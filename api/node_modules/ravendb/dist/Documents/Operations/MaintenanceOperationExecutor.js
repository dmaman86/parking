"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const OperationCompletionAwaiter_1 = require("./OperationCompletionAwaiter");
const ServerOperationExecutor_1 = require("./ServerOperationExecutor");
class MaintenanceOperationExecutor {
    constructor(store, databaseName) {
        this._store = store;
        this._databaseName = databaseName || store.database;
        this._requestExecutor = this._databaseName ? store.getRequestExecutor(databaseName) : null;
    }
    get server() {
        if (!this._serverOperationExecutor) {
            this._serverOperationExecutor = new ServerOperationExecutor_1.ServerOperationExecutor(this._store);
        }
        return this._serverOperationExecutor;
    }
    forDatabase(databaseName) {
        if (this._databaseName
            && this._databaseName.toLowerCase() === (databaseName || "").toLowerCase()) {
            return this;
        }
        return new MaintenanceOperationExecutor(this._store, databaseName);
    }
    send(operation) {
        const command = operation.getCommand(this._requestExecutor.conventions);
        const result = Promise.resolve()
            .then(() => this._requestExecutor.execute(command))
            .then(() => {
            if (operation.resultType === "OperationId") {
                const idResult = command.result;
                const awaiter = new OperationCompletionAwaiter_1.OperationCompletionAwaiter(this._requestExecutor, this._requestExecutor.conventions, idResult.operationId);
                return awaiter;
            }
            return command.result;
        });
        return result;
    }
}
exports.MaintenanceOperationExecutor = MaintenanceOperationExecutor;
