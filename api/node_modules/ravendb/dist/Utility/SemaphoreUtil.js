"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const BluebirdPromise = require("bluebird");
function acquireSemaphore(sem, semOpts) {
    const contextName = semOpts ? semOpts.contextName : "";
    const acquiredObj = {
        acquired: false
    };
    const acquiredSemaphorePromise = new BluebirdPromise.Promise(resolve => {
        sem.take(() => {
            acquiredObj.acquired = true;
            resolve();
        });
    });
    let p = acquiredSemaphorePromise;
    if (semOpts && semOpts.timeout) {
        p = p.timeout(semOpts.timeout);
    }
    const releaseFunc = () => {
        acquiredSemaphorePromise
            .then(() => sem.leave());
    };
    const result = Promise.resolve(p);
    return {
        dispose: releaseFunc,
        promise: result
    };
}
exports.acquireSemaphore = acquireSemaphore;
